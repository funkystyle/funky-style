angular.module("APP",["ui.router","oc.lazyLoad","ngSanitize","satellizer"]).directive("dealTileDirective",function(){return{restrict:"E",scope:{items:"=items",class:"@className",limit:"@",orderBy:"@"},templateUrl:"static/app/customer-panel/modules/deal.details/deal.details.directive.template.html",controller:"dealDetailsDirectiveCtrl"}}).directive("comments",function(){return{restrict:"E",scope:{info:"="},controller:"commentsCtrl",templateUrl:"static/app/customer-panel/modules/comments/comments.directive.template.html"}}).directive("commentsDisplay",function(){return{restrict:"E",scope:{items:"="},templateUrl:"static/app/customer-panel/modules/comments/comments.display.template.html"}}).directive("couponInfoPopup",function(){return{restrict:"E",scope:{couponInfo:"=coupon",parent:"=",type:"@"},controller:"couponInfoPopupCtrl",templateUrl:"static/app/customer-panel/modules/coupon.info.popup/coupon.info.popup.directive.template.html"}}).directive("reports",function(){return{restrict:"E",scope:{info:"="},controller:["$scope","$state","$stateParams","$http","auth","$auth",function(t,o,e,n,r,i){t.issue={"Not Valid":"not valid",Expired:"expired","Other Issue":"other issue"},t.report={},r.me().then(function(o){t.loggeduser=o.data}),t.submitReport=function(o){console.log("Report: ",o);n({url:"/api/1.0/coupons_reports",method:"POST",data:{user:t.loggeduser._id,coupon:t.info.item._id,status:!1,issue:o.issue,description:o.description}}).then(function(t){console.log("Report data Success: ",t),$("#reportPopup").modal("hide")},function(t){console.log(t)})}}],templateUrl:"static/app/customer-panel/modules/reports/reports.template.html"}}).controller("couponInfoPopupCtrl",["$scope","$http","$state","$ocLazyLoad","$sce","$stateParams","Query",function(t,o,e,n,r,i,c){console.log("couponInfoPopupCtrl: "),n.load("static/bower_components/clipboard/dist/clipboard.min.js").then(function(o){t.showMore={},t.stateUrls=i,t.trustAsHtml=function(t){if(t)return r.trustAsHtml(t)},$("#couponPopup").on("hidden.bs.modal",function(){e.go(".",{cc:void 0,destionationUrl:void 0})});var n=new Clipboard(".btn");n.on("success",function(t){console.info("Action:",t.action),console.info("Text:",t.text),console.info("Trigger:",t.trigger),t.clearSelection(),$("#copyClipboard").html("Copied")}),n.on("error",function(t){console.error("Action:",t.action),console.error("Trigger:",t.trigger)}),t.openCouponCode=function(t,o){var n="/api/1.0/coupons/"+o._id+"?number_of_clicks=1";c.get(n),n=e.href(e.current.name,{cc:o._id}),window.open(n,"_blank")},t.moreCoupons=[];var s=JSON.stringify({related_stores:1});url="/api/1.0/coupons?sort=-number_of_clicks&max_results=3&embedded="+s,c.get(url).then(function(o){var e=o.data._items;console.log(" Coupons Data: ",e),t.moreCoupons=e})})}]).controller("dealDetailsDirectiveCtrl",["$http","$scope","$stateParams","$state","DestionationUrl",function(t,o,e,n,r){o.openDestinationUrl=function(t){console.log(t.destination_url),r.destination_url(t.destination_url).then(function(o){var e=o.data.data.output_url;url=n.href(n.current.name,n.params),$('<a href="'+url+'" target="_blank">&nbsp;</a>')[0].click(),window.location.href=e||t.destination_url},function(t){console.log(t)})}}]).controller("commentsCtrl",["$scope","$state","$stateParams","auth","$auth","$http",function(t,o,e,n,r,i){console.log("Comments controller!"),t.comment={},n.me().then(function(o){t.loggeduser=o.data}),t.submitComment=function(o){console.log("Comment Description: ",o.comment,"Store info: ",t.info.item.related_stores);i({url:"/api/1.0/coupons_comments",method:"POST",data:{user:t.loggeduser._id,coupon:t.info.item._id,status:!1,comment:o.comment}}).then(function(t){console.log("Comment data Success: ",t),$("#commentPopup").modal("hide")},function(t){console.log(t)})}}]).factory("Query",["$http","$q",function(t,o){return{get:function(e){var n=o.defer();return t({url:e+"&r="+Math.random(),method:"GET"}).then(function(t){n.resolve(t)},function(t){n.reject(t)}),n.promise}}}]);