angular.module("headerModule",["ui.bootstrap","APP","constantModule","storeServiceModule","categoryFactoryModule","couponFactoryModule"]).controller("headerCtrl",["$scope","auth","$state","$http","URL","$filter","categoryFactory","storeFactory","couponFactory","$q","HTTP","$location",function(e,t,o,r,a,l,n,u,c,i,s,d){console.log("header controller!"),e.user={},e.featuredStores=[],e.totalItems=[],e.allStores=[],localStorage.getItem("satellizer_token")&&t.me().then(function(t){console.log("Logged User Data: ============ ",t.data),e.user=t.data},function(e){console.log(e),localStorage.removeItem("satellizer_token")});var g={projection:{name:1,url:1,image:1,featured_store:1,menu:1,related_coupons:1,"related_coupons.title":1,"related_coupons.url":1},embedded:{related_coupons:1},random_number:(new Date).getDate()};s.get(g,"stores").then(function(t){angular.forEach(t,function(t){1==t.featured_store&&e.featuredStores.push(t),e.allStores.push(t)})}),e.allCategories=[],delete g.featured_store,g.featured_category=1,s.get(g,"categories").then(function(t){e.allCategories=t}),e.getItems=function(t){if(t){var o=[],r={store:e.allStores,category:e.allCategories};return angular.forEach(r,function(e,r){angular.forEach(e,function(e){e.name.toLowerCase().indexOf(t.toLowerCase())>-1&&(e.relativePath=r,o.push(e)),angular.forEach(e.related_coupons,function(a){if(a.title.toLowerCase().indexOf(t.toLowerCase())>-1){var l={name:a.title,image:e.image,url:e.url,relativePath:r};o.push(l)}})})}),console.log("Filtered List: ",o),o}},e.goDetails=function(t,o,r){d.path("/"+t.relativePath+"/"+t.url),e.customPopupSelected=void 0},e.logout=function(){localStorage.getItem("satellizer_token")&&r({url:a.logout,method:"GET"}).then(function(e){console.log(e),localStorage.removeItem("satellizer_token"),o.go("main.login")},function(e){console.log(e)})}}]).factory("HTTP",["$http","$q",function(e,t){return{get:function(o,r){var a=t.defer(),l="/api/1.0/"+r+"?projection="+JSON.stringify(o.projection)+"&embedded="+JSON.stringify(o.embedded)+"&r="+Math.random();return e({url:l,mathod:"GET"}).then(function(e){if(e.data._items){var t=e.data._items;console.log("All ",r,t),a.resolve(t)}},function(e){console.log(e),a.reject(e)}),a.promise}}}]);