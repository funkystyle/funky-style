angular.module("allDealsModule",["Directives"]).controller("allDealsCtrl",["$scope","$state","$stateParams","$http","SEO","$rootScope",function(e,a,t,n,o,l){console.log("All Deals Controller!"),e.deals=[],e.deal_categories=[],e.deal_brands=[],e.stores=[];var r=(new Date).getDate(),s=JSON.stringify({featured:!0});n({url:"/api/1.0/deal_categories?where="+s+"&max_results=4&rand="+r,method:"GET"}).then(function(a){console.log("Deal Categories are: ",a.data._items),e.deal_categories=a.data._items},function(e){console.log(e)}),n({url:"/api/1.0/deal_brands?where="+s+"&max_results=8&rand="+r,method:"GET"}).then(function(a){console.log("Deal Brands are: ",a.data._items),e.deal_brands=a.data._items},function(e){console.log(e)});var i="/api/1.0/deals?sort=-number_of_clicks&rand_number="+r;n({url:i,method:"GET"}).then(function(a){console.log("All deals are: ",a.data._items),a.data&&(e.best_deals=a.data._items)},function(e){console.log(e)}),n({url:i="/api/1.0/deals?sort=-upcoming&rand_number="+r,method:"GET"}).then(function(a){console.log("All deals are: ",a.data._items),a.data&&(e.upcoming_deals=a.data._items)},function(e){console.log(e)}),e.banners=[];var d={top_banner_string:1,image:1,title:1,image_text:1,destination_url:1};n({url:i="/api/1.0/banner?where="+JSON.stringify({top_banner_string:"deal"})+"&projection="+JSON.stringify(d)+"&rand_number"+(new Date).getTime(),method:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(a){console.log(a),a.data&&(console.log("Banners: ",a.data._items),e.banners=a.data._items,$("#myCarousel").carousel({interval:4e3,pause:"hover",loop:!0}))},function(e){console.log(e)});var c={};c.featured_store=!0,(d={}).name=1,d.url=1,d.image=1,d.menu=1,n({url:"/api/1.0/stores/?where="+JSON.stringify(c)+"&max_results=8&projection="+JSON.stringify(d)+"&rand_number"+(new Date).getTime(),mathod:"GET"}).then(function(a){console.log(a),a.data&&(e.stores=a.data._items)},function(e){console.log(e)}),o.getSEO().then(function(e){angular.forEach(e,function(e){if("deal"==e.selection_type.code){var a=o.seo("",e,"deal");l.pageTitle=a.title,l.pageDescription=a.description}})})}]);