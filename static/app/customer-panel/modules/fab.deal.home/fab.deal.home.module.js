angular.module("allDealsModule",["Directives"]).controller("allDealsCtrl",["$scope","$state","$stateParams","$http","SEO","$rootScope",function(e,t,n,a,r,i){e.deals=[],e.deal_categories=[],e.deal_brands=[],e.stores=[];var o=(new Date).getDate(),s=JSON.stringify({status:!0}),d=JSON.stringify({featured:!0});a({url:"/api/1.0/deal_categories?where="+d+"&max_results=4&rand="+o,method:"GET"}).then(function(t){e.deal_categories=t.data._items},function(e){}),a({url:"/api/1.0/deal_brands?where="+d+"&max_results=8&rand="+o,method:"GET"}).then(function(t){e.deal_brands=t.data._items},function(e){}),a({url:l="/api/1.0/deals?where="+s+"&sort=-number_of_clicks&rand_number="+o,method:"GET"}).then(function(t){t.data&&(e.best_deals=t.data._items)},function(e){});var l="/api/1.0/deals?where="+s+"&sort=-upcoming&rand_number="+o;a({url:l,method:"GET"}).then(function(t){t.data&&(e.upcoming_deals=t.data._items)},function(e){}),e.banners=[],s=JSON.stringify({top_banner_string:"deal",expired_date:{$gte:(new Date).toGMTString()}}),projection={top_banner_string:1,image:1,title:1,image_text:1,destination_url:1},a({url:l="/api/1.0/banner?where="+s+"&projection="+JSON.stringify(projection)+"&rand_number"+(new Date).getTime(),method:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(t){t.data&&(e.banners=t.data._items,$("#myCarousel").carousel({interval:4e3,pause:"hover",loop:!0}))},function(e){});var u={};u.featured_store=!0,projection={},projection.name=1,projection.url=1,projection.image=1,projection.menu=1,a({url:"/api/1.0/stores/?where="+JSON.stringify(u)+"&max_results=8&projection="+JSON.stringify(projection)+"&rand_number"+(new Date).getTime(),mathod:"GET"}).then(function(t){t.data&&(e.stores=t.data._items)},function(e){}),r.getSEO().then(function(e){angular.forEach(e,function(e){if("deal"===e.selection_type.code){var t=r.seo("",e,"deal");i.pageTitle=t.title,i.pageDescription=t.description}})})}]);