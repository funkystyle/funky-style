angular.module("brandPageModule",["Directives"]).controller("brandPageCtrl",["$scope","$state","$stateParams","$ocLazyLoad","$http","$sce","$filter",function(e,a,t,n,r,l,i){e.search_brands={},e.search={},e.filter={priceRange:{},brands:{}},e.priceRange=[{text:"< 2000",range:"0-2000"},{text:"3000 - 5000",range:"3000-5000"},{text:"7000 - 10000",range:"7000-10000"},{text:"> 10000",range:"10000-40000"}],e.applyFilter=function(){e.filterDeals=i("applyFilter")(e.deals,e.filter)},n.load(["static/bower_components/owl.carousel/owl.carousel.css","static/bower_components/owl.carousel/owl.carousel.js"]).then(function(){function n(){var e=this.parentNode,a=e.getElementsByTagName("input"),t=parseFloat(a[0].value),n=parseFloat(a[1].value);if(t>n){var r=n;n=t,t=r}e.getElementsByClassName("rangeValues")[0].innerHTML=t+" - "+n}window.onload=function(){for(var e=document.getElementsByClassName("range-slider"),a=0;a<e.length;a++)for(var t=e[a].getElementsByTagName("input"),r=0;r<t.length;r++)"range"===t[r].type&&(t[r].oninput=n,t[r].oninput())},e.trustAsHtml=function(e){if(e)return l.trustAsHtml(e)},e.deal={},e.deals=[],e.brands=[];var s=(new Date).getDate();if(t.url){var o={url:t.url},d={related_brands:1};r({url:"/api/1.0/deal_brands?where="+JSON.stringify(o)+"&rand="+s+"&embedded="+JSON.stringify(d),method:"GET"}).then(function(t){0===t.data._items.length&&a.go("404"),e.deal=t.data._items[0],e.deal.toDayDate=new Date;var n={};n.related_deals=1,n.deal_brands=1,n.deal_category=1,n["stores.store"]=1;var l={deal_brands:e.deal._id,status:!0},o="/api/1.0/deals?where="+JSON.stringify(l)+"&embedded="+JSON.stringify(n)+"&rand_number="+s;r({url:o,method:"GET"}).then(function(a){a.data&&(e.deals=a.data._items,e.filterDeals=a.data._items,angular.forEach(e.deals,function(a){angular.forEach(a.deal_brands,function(a){0===i("filter")(e.brands,{_id:a._id}).length&&e.brands.push(a)})}))},function(e){})},function(e){})}})}]).filter("applyFilter",["$filter",function(e){return function(a,t){var n=[];if(!Object.keys(t.priceRange).length&&!Object.keys(t.brands).length)return a;var r=0;return angular.forEach(t,function(e,a){angular.forEach(e,function(e,a){1==e&&r++})}),0==r?a:(angular.forEach(a,function(a){angular.forEach(t.priceRange,function(t,r){var l=r.split("-")[0],i=r.split("-")[1];1==t&&a.actual_price>l&&a.actual_price<i&&0==e("filter")(n,{_id:a._id}).length&&n.push(a)}),angular.forEach(t.brands,function(t,r){angular.forEach(a.deal_brands,function(l){1==t&&r==l._id&&0==e("filter")(n,{_id:a._id}).length&&n.push(a)})})}),n)}}]);