angular.module("homeModule",["headerModule","Directives"]).controller("homeCtrl",["$scope","$sce","$http","$filter","$ocLazyLoad","$state","$stateParams","$rootScope","SEO","$compile","Query",function(e,o,n,t,a,r,i,c,s,u,d){console.log("home controller"),e.params=void 0,e.deals=[],e.coupons=[],e.categories=[];var l={};l.related_categories=1,l.related_stores=1;var p="/api/1.0/coupons?sort=-_created&embedded="+JSON.stringify(l)+"&rand_number"+(new Date).getTime();n({url:p,method:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(o){if(console.log(o),o.data){var n=o.data._items;angular.forEach(n,function(o){new Date(o.expire_date)>new Date&&-1==e.coupons.indexOf(o)&&e.coupons.push(o)})}},function(e){console.log(e)}),s.getSEO().then(function(e){angular.forEach(e,function(e){if("home"==e.selection_type.code){var o=s.seo("",e,"home");c.pageTitle=o.title,c.pageDescription=o.description}})}),e.banners=[];var g={top_banner_string:1,image:1,title:1,image_text:1,destination_url:1};n({url:p="/api/1.0/banner?where="+JSON.stringify({top_banner_string:"home"})+"&projection="+JSON.stringify(g)+"&rand_number"+(new Date).getTime(),method:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(o){console.log(o),o.data&&(console.log("Banners: ",o.data._items),e.banners=o.data._items,$("#myCarousel").carousel({interval:4e3,pause:"hover",loop:!0}))},function(e){console.log(e)}),e.openCouponCode=function(e,o){var n="/api/1.0/coupons/"+o._id+"?number_of_clicks=1";d.get(n),n=r.href("main.home",{cc:o._id}),window.open(n,"_blank")};var f={};f.featured_store=!0,(g={}).name=1,g.url=1,g.image=1,g.menu=1,g.related_coupons=1,n({url:"/api/1.0/stores/?where="+JSON.stringify(f)+"&max_results=24&projection="+JSON.stringify(g)+"&rand_number"+(new Date).getTime(),mathod:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(o){console.log(o),o.data&&(e.stores=o.data._items)},function(e){console.log(e)});var m={};m.featured_category=!0,(g={}).name=1,g.url=1,g.image=1,g.related_coupons=1,n({url:"/api/1.0/categories/?where="+JSON.stringify(m)+"&max_results=24&projection="+JSON.stringify(g)+"&rand_number"+(new Date).getTime(),mathod:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(o){console.log(o),o.data&&(e.categories=o.data._items)},function(e){console.log(e)}),n({url:"/api/1.0/deals?max_results=24&rand_number"+(new Date).getTime(),mathod:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(o){console.log(o),o.data&&(e.deals=o.data._items)},function(e){console.log(e)}),i.cc&&($("coupon-info-popup").remove(),e.$watch("coupons",function(o,n){o&&angular.forEach(o,function(o){if(o._id==i.cc){e.couponInfo=o,console.log("Coupon Info: ",e.couponInfo);var n=u("<coupon-info-popup type='home' coupon='couponInfo'></coupon-info-popup>")(e);$("body").append(n),setTimeout(function(){$("#couponPopup").modal("show")},1e3)}})},!0)),e.trustAsHtml=function(e){if(e)return o.trustAsHtml(e)},e.showDescription=function(e){$(".show-description").hide(),$("#show-desc-"+e).fadeIn(200)},e.closeDescription=function(){$(".show-description").fadeOut()}}]).factory("Query",["$http","$q",function(e,o){return{get:function(n){var t=o.defer();return e({url:n+"&r="+Math.random(),method:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}}]);