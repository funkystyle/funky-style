angular.module("homeModule",["headerModule","storeServiceModule","couponFactoryModule","dealFactoryModule","categoryFactoryModule","Directives"]).controller("homeCtrl",["$scope","$sce","storeFactory","$http","couponFactory","$filter","dealFactory","categoryFactory","$ocLazyLoad","$state","$stateParams","$rootScope","SEO","$compile","Query",function(o,e,n,t,a,r,i,c,s,u,l,d,p,f,m){console.log("home controller"),o.params=void 0,o.deals=[],o.coupons=[],o.categories=[];var g={};g.related_categories=1,g.related_stores=1;var h="/api/1.0/coupons?sort=-_created&embedded="+JSON.stringify(g)+"&rand_number"+(new Date).getTime();t({url:h,method:"GET"}).then(function(e){if(console.log(e),e.data){var n=e.data._items;angular.forEach(n,function(e){new Date(e.expire_date)>new Date&&-1==o.coupons.indexOf(e)&&o.coupons.push(e)})}},function(o){console.log(o)}),p.getSEO().then(function(o){angular.forEach(o,function(o){if("home"==o.selection_type.code){var e=p.seo("",o,"home");d.pageTitle=e.title,d.pageDescription=e.description}})}),o.banners=[];var _={top_banner_string:1,image:1,title:1,image_text:1};t({url:h="/api/1.0/banner?where="+JSON.stringify({top_banner_string:"home"})+"&projection="+JSON.stringify(_)+"&rand_number"+(new Date).getTime(),method:"GET"}).then(function(e){console.log(e),e.data&&(console.log("Banners: ",e.data._items),o.banners=e.data._items)},function(o){console.log(o)}),o.openCouponCode=function(o,e){var n="/api/1.0/coupons/"+e._id+"?number_of_clicks=1";m.get(n),n=u.href("main.home",{cc:e._id}),window.open(n,"_blank")};var y={};y.featured_store=!0,(_={}).name=1,_.url=1,_.image=1,_.menu=1,t({url:"/api/1.0/stores/?where="+JSON.stringify(y)+"&max_results=24&projection="+JSON.stringify(_)+"&rand_number"+(new Date).getTime(),mathod:"GET"}).then(function(e){console.log(e),e.data&&(o.stores=e.data._items)},function(o){console.log(o)});var w={};w.featured_category=!0,(_={}).name=1,_.url=1,_.image=1,t({url:"/api/1.0/categories/?where="+JSON.stringify(w)+"&max_results=24&projection="+JSON.stringify(_)+"&rand_number"+(new Date).getTime(),mathod:"GET"}).then(function(e){console.log(e),e.data&&(o.categories=e.data._items)},function(o){console.log(o)}),t({url:"/api/1.0/deals?max_results=24&rand_number"+(new Date).getTime(),mathod:"GET"}).then(function(e){console.log(e),e.data&&(o.deals=e.data._items)},function(o){console.log(o)}),l.cc&&($("coupon-info-popup").remove(),o.$watch("coupons",function(e,n){e&&angular.forEach(e,function(e){if(e._id==l.cc){o.couponInfo=e,console.log("Coupon Info: ",o.couponInfo);var n=f("<coupon-info-popup type='home' coupon='couponInfo'></coupon-info-popup>")(o);$("body").append(n),setTimeout(function(){$("#couponPopup").modal("show")},1e3)}})},!0)),o.trustAsHtml=function(o){if(o)return e.trustAsHtml(o)},o.showDescription=function(o){$(".show-description").hide(),$("#show-desc-"+o).fadeIn(200)},o.closeDescription=function(){$(".show-description").fadeOut()}}]).factory("Query",["$http","$q",function(o,e){return{get:function(n){var t=e.defer();return o({url:n+"&r="+Math.random(),method:"GET"}).then(function(o){t.resolve(o)},function(o){t.reject(o)}),t.promise}}}]);