angular.module("homeModule",["headerModule","Directives","toastr"]).controller("homeCtrl",["$scope","$sce","$http","$filter","toastr","$ocLazyLoad","$state","$stateParams","$rootScope","SEO","$compile","Query","DestionationUrl",function(e,o,t,n,r,i,a,s,u,c,p,d,l){e.params=void 0,e.deals=[],e.categories=[];var f={};f.related_categories=1,f.related_stores=1,e.fillCoupons=function(o){e.coupons=[],d.get(o).then(function(o){if(o.data){var t=o.data._items;angular.forEach(t,function(o){new Date(o.expire_date)>new Date&&-1===e.coupons.indexOf(o)&&e.coupons.push(o)})}},function(e){})},e.featuredResults=function(){var o="/api/1.0/coupons?where="+JSON.stringify({featured_coupon:!0,status:"Publish"})+"&max_results=10&sort=-_created&embedded="+JSON.stringify(f)+"&rand="+Math.random();e.fillCoupons(o)},e.featuredResults(),e.fetchCoupons=function(o){var t="/api/1.0/coupons?where="+JSON.stringify({status:"Publish"})+"&max_results=10&sort=-"+o+"&embedded="+JSON.stringify(f)+"&rand="+Math.random();e.fillCoupons(t)},c.getSEO().then(function(e){angular.forEach(e,function(e){"home"===e.selection_type.code&&c.seo("",e,"home")})}),e.banners=[];var h=JSON.stringify({top_banner_string:"home",expired_date:{$gte:(new Date).toGMTString()}});projection={top_banner_string:1,image:1,title:1,image_text:1,destination_url:1},url="/api/1.0/banner?where="+h+"&projection="+JSON.stringify(projection),d.get(url).then(function(o){o.data&&(e.banners=o.data._items,$("#myCarousel").carousel({interval:4e3,pause:"hover",loop:!0}))},function(e){}),e.openCouponCode=function(e,o){l.destination_url(o.destination_url).then(function(e){var t=e.data.data.output_url,n=t||o.destination_url,i=a.go("main.home",{cc:o._id,destionationUrl:n}),s=window.open(i,"newtab");null===s||void 0===s?r.error("Please disable your pop-up blocker and click the link again to copy your Coupon Code","Disable Pop-Up Blocker!"):(s.focus(),window.location.href=n)})};var m={};m.featured_store=!0,projection={},projection.name=1,projection.url=1,projection.image=1,projection.menu=1,projection.related_coupons=1,url="/api/1.0/stores/?where="+JSON.stringify(m)+"&max_results=24&projection="+JSON.stringify(projection),d.get(url).then(function(o){o.data&&(e.stores=o.data._items)},function(e){});var g={};g.featured_category=!0,url="/api/1.0/categories/?where="+JSON.stringify(g)+"&max_results=24&projection="+JSON.stringify(projection),d.get(url).then(function(o){o.data&&(e.categories=o.data._items)},function(e){}),h=JSON.stringify({status:!0}),url="/api/1.0/deals?where="+h+"&max_results=24",d.get(url).then(function(o){o.data&&(e.deals=o.data._items)},function(e){}),s.cc&&($("coupon-info-popup").remove(),f=JSON.stringify({related_stores:1,related_categories:1}),url="/api/1.0/coupons/"+s.cc+"?number_of_clicks=1&embedded="+f+"&rand="+Math.random(),d.get(url).then(function(o){e.couponInfo=o.data;var t=p("<coupon-info-popup type='home' coupon='couponInfo'></coupon-info-popup>")(e);$("body").append(t),setTimeout(function(){$("#couponPopup").modal("show")},1e3)},function(e){a.go("main.home",{cc:void 0,destionationUrl:void 0})})),e.trustAsHtml=function(e){if(e)return o.trustAsHtml(e)},e.showDescription=function(e){$(".show-description").hide(),$("#show-desc-"+e).fadeIn(200)},e.closeDescription=function(){$(".show-description").fadeOut()}}]).factory("Query",["$http","$q",function(e,o){return{get:function(t){var n=o.defer();return e({url:t+"&r="+Math.random(),method:"GET",headers:{"Content-Encoding":"gzip"}}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}]);