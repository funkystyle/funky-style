angular.module("dealDetailsModule",["Directives"]).controller("dealDetailsCtrl",["$scope","$ocLazyLoad","$http","$state","$stateParams","$sce",function(e,t,a,o,n,r){console.log("deal Details controller!"),e.deal={},e.showMore={},e.imageShow={},e.trustAsHtml=function(e){if(e)return r.trustAsHtml(e)};var l=(new Date).getDate();if(a({url:"/api/1.0/deal_brands?where="+JSON.stringify({featured:!0})+"&max_results=8&rand="+l,method:"GET"}).then(function(t){console.log("Deal Brands are: ",t.data._items),e.deal_brands=t.data._items},function(e){console.log(e)}),n.url){a({url:"/api/1.0/deals?where="+JSON.stringify({url:n.url})+"&number_of_clicks=1&embedded="+JSON.stringify({related_deals:1,deal_brands:1,deal_category:1,stores:1,"stores.store":1})+"&rand_number"+Math.random(),method:"GET"}).then(function(t){console.log(t),t.data&&t.data._items.length?(console.log(t.data._items[0]),e.deal=t.data._items[0],e.deal.toDayDate=new Date,e.deal.voting=Math.floor(201*Math.random())+300,e.deal.expired_date=new Date(e.deal.expired_date)):o.go("404")},function(e){console.log(e)}),e.top_stores=[];var s={name:1,url:1,image:1};a({url:"/api/1.0/stores?projection="+JSON.stringify(s)+"&rand_number"+(new Date).getTime(),method:"GET"}).then(function(t){t.data&&(e.top_stores=t.data._items)},function(e){console.log(e)})}}]).filter("quickLimit",function(){return function(e){var t={};return angular.forEach(e,function(e,a){Object.keys(t).length<15&&(t[a]=e)}),t}});