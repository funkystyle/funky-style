angular.module("dealDetailsModule",["Directives"]).controller("dealDetailsCtrl",["$scope","$ocLazyLoad","$http","$state","$stateParams","$sce",function(e,t,o,a,r,n){console.log("deal Details controller!"),e.deal={},e.showMore={},e.imageShow={},e.trustAsHtml=function(e){if(e)return n.trustAsHtml(e)},e.goScroll=function(e){console.log($("#"+e).position().top+150),$("html, body").animate({scrollTop:$("#"+e).offset().top-150})};var l=(new Date).getDate(),s=JSON.stringify({featured:!0});if(o({url:"/api/1.0/deal_brands?where="+s+"&max_results=8&rand="+l,method:"GET"}).then(function(t){console.log("Deal Brands are: ",t.data._items),e.deal_brands=t.data._items},function(e){console.log(e)}),r.url){var i="/api/1.0/deals?where="+JSON.stringify({url:r.url})+"&number_of_clicks=1&embedded="+JSON.stringify({related_deals:1,deal_brands:1,deal_category:1,stores:1,"stores.store":1,store_temp:1})+"&rand_number"+Math.random();o({url:i,method:"GET"}).then(function(t){if(console.log(t),t.data&&t.data._items.length){if(console.log(t.data._items[0]),e.deal=t.data._items[0],e.deal.toDayDate=new Date,e.deal.voting=Math.floor(201*Math.random())+300,e.deal.expired_date=new Date(e.deal.expired_date),"store"==e.deal.deal_type){var r={};r.related_stores={$in:[e.deal.store_temp._id]};i="/api/1.0/coupons?where="+JSON.stringify(r)+"&max_results=5&sort=[('_updated', -1)]",o({url:i,method:"GET"}).then(function(t){console.log("Coupons List: ",t),e.store_related_coupons=t.data._items})}}else a.go("404")},function(e){console.log(e)}),e.top_stores=[];var d={name:1,url:1,image:1};o({url:"/api/1.0/stores?projection="+JSON.stringify(d)+"&rand_number"+(new Date).getTime(),method:"GET"}).then(function(t){t.data&&(e.top_stores=t.data._items)},function(e){console.log(e)})}}]).filter("quickLimit",function(){return function(e){var t={};return angular.forEach(e,function(e,o){Object.keys(t).length<15&&(t[o]=e)}),t}});