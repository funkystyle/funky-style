angular.module("dealCategoryPageModule",["Directives"]).controller("dealCategoryPageCtrl",["$scope","$state","$stateParams","$ocLazyLoad","$http","$sce","$filter","$rootScope",function(e,a,t,r,o,l,n,i){console.log("Deal category page controller !"),e.search_brands={},e.search={},e.filter={priceRange:{},brands:{}},e.priceRange=[{text:"< 2000",range:"0-2000"},{text:"3000 - 5000",range:"3000-5000"},{text:"7000 - 10000",range:"7000-10000"},{text:"> 10000",range:"10000-40000"}],e.applyFilter=function(){e.filterDeals=n("applyFilter")(e.deals,e.filter)},r.load(["static/bower_components/owl.carousel/owl.carousel.css","static/bower_components/owl.carousel/owl.carousel.js"]).then(function(){function r(){var e=this.parentNode,a=e.getElementsByTagName("input"),t=parseFloat(a[0].value),r=parseFloat(a[1].value);if(t>r){var o=r;r=t,t=o}e.getElementsByClassName("rangeValues")[0].innerHTML=t+" - "+r}window.onload=function(){for(var e=document.getElementsByClassName("range-slider"),a=0;a<e.length;a++)for(var t=e[a].getElementsByTagName("input"),o=0;o<t.length;o++)"range"===t[o].type&&(t[o].oninput=r,t[o].oninput())},e.trustAsHtml=function(e){if(e)return l.trustAsHtml(e)},e.deal={},e.deals=[],e.deal_categories=[],e.categories=[];var s=(new Date).getDate();if(t.url){var c={url:t.url},g={related_categories:1};o({url:"/api/1.0/deal_categories?where="+JSON.stringify(c)+"&rand="+s+"&embedded="+JSON.stringify(g),method:"GET"}).then(function(t){0==t.data._items.length&&a.go("404"),console.log("Deal brand is: ",t.data._items[0]),e.deal=t.data._items[0],e.deal.toDayDate=new Date,e.deal.voting=Math.floor(201*Math.random())+300,i.pageTitle=e.deal.seo_title,i.pageDescription=e.deal.seo_description,i.pageTitle=e.deal.seo_title,i.pageDescription=e.deal.seo_description,setTimeout(function(){$("#owl-demo").owlCarousel({autoPlay:2e3,transitionStyle:"fade",loop:!0,items:5,itemsDesktop:[1199,3],itemsDesktopSmall:[979,3]})});var r={};r.related_deals=1,r.deal_categories=1,r.deal_category=1,r["stores.store"]=1;var l={deal_category:e.deal._id,status:!0},c="/api/1.0/deals?where="+JSON.stringify(l)+"&embedded="+JSON.stringify(r)+"&rand_number="+s;o({url:c,method:"GET"}).then(function(a){console.log(a),a.data&&(e.deals=a.data._items,e.filterDeals=a.data._items,angular.forEach(e.deals,function(a){angular.forEach(a.deal_category,function(a){0===n("filter")(e.categories,{_id:a._id}).length&&e.categories.push(a)})}))},function(e){console.log(e)})},function(e){console.log(e)})}})}]).filter("applyFilter",["$filter",function(e){return function(a,t){var r=[];if(!Object.keys(t.priceRange).length&&!Object.keys(t.categories).length)return a;var o=0;return angular.forEach(t,function(e,a){angular.forEach(e,function(e,a){!0===e&&o++})}),0===o?a:(angular.forEach(a,function(a){angular.forEach(t.priceRange,function(t,o){var l=o.split("-")[0],n=o.split("-")[1];!0===t&&a.actual_price>l&&a.actual_price<n&&0===e("filter")(r,{_id:a._id}).length&&r.push(a)}),angular.forEach(t.categories,function(t,o){angular.forEach(a.deal_category,function(l){!0===t&&o===l._id&&0===e("filter")(r,{_id:a._id}).length&&r.push(a)})})}),r)}}]);